<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapters Viewer</title>

<style>
body {
  background:#121212;
  color:#fff;
  font-family:Arial, sans-serif;
  text-align:center;
  margin:0;
}
.container {
  display:flex;
  flex-direction:column;
  align-items:center;
}
img {
  max-width:100%;
  margin-bottom:6px;
  box-shadow:0 2px 4px rgba(0,0,0,0.8);
}
input,button {
  margin:8px;
  padding:10px;
  font-size:16px;
}
button {
  background:#ff4081;
  color:#fff;
  border:none;
  cursor:pointer;
}
#status {
  position:fixed;
  bottom:15px;
  right:15px;
  background:rgba(255,255,255,.7);
  color:#000;
  padding:6px 12px;
  border-radius:20px;
  display:none;
}
#toTopBtn {
  position:fixed;
  bottom:15px;
  left:15px;
  padding:8px 12px;
  border-radius:20px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>Chapters Viewer</h1>

<input id="baseUrl" placeholder="Base URL ending with /"><br>
<input id="startPage" type="number" value="1"><br>
<input id="endPage" type="number"><br>
<button onclick="loadChapter()">Load</button>

<div class="container" id="imageContainer"></div>

<div id="status">⏳</div>
<button id="toTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑ 0</button>

<script>
const formats = ["png","jpg","jpeg","webp"];
const container = document.getElementById("imageContainer");
const status = document.getElementById("status");
const toTopBtn = document.getElementById("toTopBtn");

const observer = new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      toTopBtn.textContent = "↑ " + e.target.dataset.page;
    }
  });
},{threshold:.5});

function loadChapter(){
  let baseUrl = document.getElementById("baseUrl").value.trim();
  const start = +document.getElementById("startPage").value;
  const end = +document.getElementById("endPage").value;

  if (!baseUrl.endsWith("/")) baseUrl += "/";
  if (!baseUrl || !start || !end || end < start){
    alert("Invalid input");
    return;
  }

  container.innerHTML = "";
  status.style.display = "block";

  for (let page=start; page<=end; page++){
    status.textContent = "⏳ " + page;

    const img = document.createElement("img");
    img.dataset.page = page;
    img.loading = "lazy";

    let idx = 0;

    img.onerror = () => {
      idx++;
      if (idx < formats.length){
        img.src = `${baseUrl}${page}.${formats[idx]}`;
      }
    };

    img.onload = () => observer.observe(img);

    // IMPORTANT: append FIRST
    container.appendChild(img);

    // then set src
    img.src = `${baseUrl}${page}.${formats[0]}`;
  }

  status.textContent = "✅ Done";
  setTimeout(()=>status.style.display="none",1500);
}
</script>

</body>
</html>
